<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>class</title>
<link rel="stylesheet" href="../vendor/qunit/qunit.css">
</head>
<body>
  <h1 id="qunit-header">QUnit Test Suite</h1>
  <h2 id="qunit-banner"></h2>
  <div id="qunit-testrunner-toolbar"></div>
  <h2 id="qunit-userAgent"></h2>
  <ol id="qunit-tests"></ol>
  <div id="qunit-fixture">test markup</div>
  <script src="../vendor/jquery/jquery.js"></script>
  <script src="../vendor/seajs/sea.js"></script>
  <script src="../vendor/qunit/qunit.js"></script>
  <script>
    QUnit.config.autostart = false;

    seajs.config({
      'base': '../sea-modules/',
      'map': [
      ],
      'alias': {
      }
    });

    seajs.use(['../src/class'], function (Class) {

      'use strict';

      QUnit.start();

      test('instanceof', function() {
        var ClassA = Class.create();
        var ClassB = ClassA.extend({});
        ok( new Class instanceof Class &&
            new ClassA instanceof Class &&
            new ClassB instanceof Class &&
            new ClassB instanceof ClassA,
            'instance is a instance of Class and panret class' );
      });

      test('constructor', function() {
        var ClassA = Class.create();
        var ClassB = ClassA.extend({});
        ok( (new Class).constructor === Class &&
            (new ClassA).constructor === ClassA &&
            (new ClassB).constructor === ClassB,
            'constructor of a instance is the direct class' );
      });

      test('new', function() {
        var ClassA = Class.create();
        ok( new ClassA() !== new ClassA(), 'new is new' );
      });

      test('initialize', function() {
        var ClassA = Class.create({
          initialize: function (x) {
            this.x = x;
          }
        });
        ok( new ClassA(2).x === 2, 'initialize initialized' );
      });

      test('extend', function() {
        var ClassA = Class.create(),
          instanceA = new ClassA();
        instanceA.extend({ x: 1, y: 2 }, { x: 3 });
        ok( instanceA.x === 3 &&
            instanceA.y === 2,
            'prototype method extend' );
      });

      test('Class.create', function() {
        var ClassA = Class.create(function () {}, {
            initialize: function () {
              this.xy = this.x + this.y;
            },
            x: 1,
            y: 2
          }),
          ClassB = Class.create(ClassA, {
            initialize: function () {
              ClassB.superclass.initialize.apply(this, arguments);
              this.xyz = this.x + this.y + this.z;
            },
            x: 3,
            z: 4
          }),
          ClassC = Class.create(ClassB, {
            initialize: function () {
              ClassC.superclass.initialize.apply(this, arguments);
              this.xyzk = this.x + this.y + this.z + this.k;
            },
            k: 5
          }),
          instanceA = new ClassA(),
          instanceB = new ClassB(),
          instanceC = new ClassC();
        ok( instanceA.xy === 3 &&
            instanceB.xy === 5 &&
            instanceB.xyz === 9 &&
            instanceC.xy === 5 &&
            instanceC.xyz === 9 &&
            instanceC.xyzk === 14,
            'extend class with static method create' );
      });

      test('Class.create with mixins', function() {
        var proto1 = {
            a: 1
          },
          proto2 = {
            x: function () {
              return this.a;
            }
          },
          ClassA = Class.create({
            mixins: [proto1, proto2]
          }),
          instanceA = new ClassA();
        equal( instanceA.x(), 1, 'protos mixed in' );
      });

      test('Class.extend', function() {
        var ClassA = Class.create({
            initialize: function () {
              this.xy = this.x + this.y;
            },
            x: 1,
            y: 2
          }),
          ClassB = ClassA.extend({
            initialize: function () {
              ClassB.superclass.initialize.apply(this, arguments);
              this.xyz = this.x + this.y + this.z;
            },
            x: 3,
            z: 4
          }),
          ClassC = ClassB.extend({
            initialize: function () {
              ClassC.superclass.initialize.apply(this, arguments);
              this.xyzk = this.x + this.y + this.z + this.k;
            },
            k: 5
          }),
          instanceA = new ClassA(),
          instanceB = new ClassB(),
          instanceC = new ClassC();
        ok( instanceA.x === 1 &&
            instanceA.y === 2 &&
            instanceA.xy === 3 &&
            instanceB.x === 3 &&
            instanceB.y === 2 &&
            instanceB.z === 4 &&
            instanceB.xy === 5 &&
            instanceB.xyz === 9 &&
            instanceC.x === 3 &&
            instanceC.y === 2 &&
            instanceC.z === 4 &&
            instanceC.xy === 5 &&
            instanceC.xyz === 9 &&
            instanceC.xyzk === 14,
            'extend class with static method extend' );
      });

      test('Class.extend with mixins', function() {
        var proto1 = {
            a: 1
          },
          proto2 = {
            x: function () {
              return this.a;
            }
          },
          ClassA = Class.create({
            mixins: [proto1]
          }),
          ClassB = ClassA.extend({
            mixins: [proto2]
          }),
          instanceA = new ClassA(),
          instanceB = new ClassB();
        ok( instanceA.a === 1 &&
            instanceB.x() === 1,
            'protos mixed in' );
      });

      test('Class.extend', function() {
        var ClassA = Class.create({
            initialize: function () {
              this.setup();
            },
            setup: function () {
            }
          }),
          ClassC = ClassA.extend({
            defaults: {
              z: 5
            },
            setup: function () {
              var defaults = {
                  x: 3,
                  y: 4
                },
                ClassB = ClassA.extend({
                  defaults: defaults,
                  setup: function () {
                  deepEqual( this.defaults, {
                    x: 3,
                    y: 4
                    }, '' );
                  }
                });
              new ClassB();
              deepEqual( this.defaults, {
                z: 5
              }, 'properties copied, not linked' );
            }
          });
        new ClassC();
      });

    });
  </script>
</body>
</html>
